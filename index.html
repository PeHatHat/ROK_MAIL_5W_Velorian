<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ROK Text Formatter</title>
  <style>
    #editor {
      border: 1px solid #ccc;
      min-height: 200px;
      padding: 10px;
      font-size: 18px;
    }
    .toolbar button, .toolbar input[type="color"] {
      margin-right: 5px;
      font-size: 16px;
    }
    #output {
      width: 100%;
      height: 200px;
      font-family: monospace;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="format('bold')">ðŸ…‘</button>
    <button onclick="format('italic')">ðŸ…˜</button>
    <input type="color" id="colorPicker" onchange="applyColor(this.value)">
    <button onclick="exportROK()">ðŸ’¾ Xuáº¥t mÃ£ ROK</button>
  </div>

  <div id="editor" contenteditable="true"></div>
  <textarea id="output" readonly></textarea>

  <script>
    function format(cmd) {
      document.execCommand(cmd, false, null);
    }

    function applyColor(color) {
      document.execCommand("foreColor", false, color);
    }

    function exportROK() {
      const editor = document.getElementById("editor");
      let output = convertToROK(editor);
      document.getElementById("output").value = output;
    }

    function convertToROK(container) {
      function traverse(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          return node.nodeValue;
        }

        let tagOpen = "", tagClose = "", content = "";

        if (node.nodeType === Node.ELEMENT_NODE) {
          const tag = node.tagName.toLowerCase();

          let styles = getComputedStyle(node);
          let color = styles.color;

          let isBold = styles.fontWeight === "700" || tag === "b" || node.style.fontWeight === "bold";
          let isItalic = styles.fontStyle === "italic" || tag === "i" || node.style.fontStyle === "italic";

          if (isBold && isItalic) {
            tagOpen += "<b><i>";
            tagClose = "</i></b>" + tagClose;
          } else if (isBold) {
            tagOpen += "<b>";
            tagClose = "</b>" + tagClose;
          } else if (isItalic) {
            tagOpen += "<i>";
            tagClose = "</i>" + tagClose;
          }

          if (color && color !== "rgb(0, 0, 0)") {
            const hex = rgbToHex(color);
            tagOpen += `<color=${hex}>`;
            tagClose = `</color>` + tagClose;
          }
        }

        for (let child of node.childNodes) {
          content += traverse(child);
        }

        return tagOpen + content + tagClose;
      }

      function rgbToHex(rgb) {
        const result = rgb.match(/\d+/g).map(x => parseInt(x).toString(16).padStart(2, '0'));
        return `#${result.join('').toUpperCase()}`;
      }

      return traverse(container).trim();
    }
  </script>
</body>
</html>
